<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <title>ふたりの官能小説(仮)</title>
    <script>
        $(function () {
            // DBの定期的な監視
            window.setInterval(function () {
                console.log('check data base')
                $.post('check.php', {
                    'key': 'gyayhfx5'
                },
                    function (data) {
                        update(data);
                    },
                    "json"
                )
            }, 1000);
        });
    </script>
</head>

<body class="main1">
    <!-- <a href="./"><h1>ふたりの官能小説(仮)</h1></a> -->
    <div class="edit">
        <div class="edit_msg">＊描き終わったら、左下の入稿ボタンをタッチしてください。</div>
        <div class="edit_key">gyayhfx5</div>
        <div class="edit_word">濃密な昼下がり</div>
        <div class="edit_meaning">濃密な昼下がり</div>

        <div id="status"></div>
        <div id="script">
            <div class="sentence">葦がうっそうと生え散らかる湖畔</div>

            <div class="sentence">湖に浮かぶ孤島は深紅に紅葉している</div>

            <div class="sentence">分け入るように指をすすめると女は身をよじった</div>

            <div class="sentence">天変地異だ</div>

            <div class="sentence">花は枯れ大地は吹き荒れる</div>

            <div class="sentence">ぽたりっ、雫が落ちた。途端に、超巨大隕石は落ちてきたのだ</div>

        </div>
        
            <textarea name="sentence" id="sentence" cols="30" rows="10"></textarea>
            <div class="update_ellipse ellipse"></div>
            <button id="update">更新</button>
            <div class="draft_ellipse ellipse"></div>
            <button id="draft">入稿</button>

    </div>




    <script>
        const myEditId = 1;
        const editor = 1;
        check_editor(editor);

        // console.log(editor);
        // console.log($('#sentence').val());

        $('#update').click(function () {
            let new_sentence = $('#script').html() + '<div class="sentence">' + $('#sentence').val() + '</div>';
            $.post('update.php', {
                'sentence': new_sentence,
                'editor': myEditId * -1,
                'key': 'gyayhfx5'
            },
                function (data) {
                    update(data);
                    $('#sentence').val('');
                },
                "json"
            )
        });

        function check_editor(_editor) {
            if (_editor === myEditId) {
                $('#status').text('あなたのばん');
                $('#sentence').attr('readonly', false);
            } else {
                $('#status').text('あいてのばん');
                $('#sentence').attr('readonly', true);
            }
        }

        function update(data) {
            console.log(data.editor);
            $('#script').html(data.sentence);
            check_editor(data.editor);
        }
    </script>
</body>

</html>